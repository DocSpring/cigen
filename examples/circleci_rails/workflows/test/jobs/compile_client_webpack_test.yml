image: cimg/ruby:3.3.5
architectures: ["amd64", "arm64"]
resource_class: medium

requires:
  - "install_app_npm_packages"

cache:
  client_webpack_test: "client/dist"

source_files: "javascript"

steps:
  - run:
      name: Compile client webpack for test
      command: |
        echo "Compiling client webpack for test environment"

        cd client
        pnpm build:test

        # Verify build output exists
        if [ ! -d "dist" ]; then
          echo "Error: Client dist directory not found after compilation"
          exit 1
        fi

        echo "Client webpack compiled successfully for test"
